<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pipeway Engenharia - Intranet</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="home.css" />
</head>
<body>

  <video autoplay muted loop class="video-bg">
    <source src="pipeway.mp4" type="video/mp4" />
    Seu navegador não suporta vídeo de fundo.
  </video>
  <div class="video-mask"></div>

  <div class="header">
    <div class="header-left">
      <div class="login-icon" onclick="abrirModalLogin()">
        <i class="fas fa-user-circle"></i>
        <span id="login-text">Entrar</span>
      </div>
    </div>
    <div class="branding">
      <h1>PIPEWAY</h1>
      <div class="subtitle">Intranet Corporativa</div>
    </div>
    <div class="header-right">
      <div class="counter">
        <i class="fas fa-users"></i>
        <span id="visitor-count">1245</span> Visitantes
      </div>
    </div>
  </div>

  <div class="widgets-container">
    <div class="widget">
      <div class="widget-header">
        <i class="fas fa-dollar-sign"></i>
        <span>Dólar Comercial (USD)</span>
      </div>
      <div class="widget-content">
        <div class="dollar-value" id="widget-dollar-value">Carregando...</div>
        <div class="dollar-variation" id="widget-dollar-variation"></div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="main">
      <h2>Bem-vindo à Intranet Pipeway</h2>
      <p>Selecione uma das opções no menu abaixo para acessar os recursos da intranet corporativa.</p>
      
      <div class="carousel-container">
        <div class="carousel" id="carousel"></div>
        <button class="carousel-nav prev"><i class="fas fa-chevron-left"></i></button>
        <button class="carousel-nav next"><i class="fas fa-chevron-right"></i></button>
        <div class="carousel-indicators" id="carousel-indicators"></div>
      </div>
      
      <div class="comunicados-section">
        <h2><i class="fas fa-bullhorn"></i> Comunicados</h2>
        <div id="comunicados-gerais" class="comunicados-grid"></div>
      </div>

      <div class="dashboard" id="dashboard-google" style="margin-top: 40px; display: none;">
        <div class="card">
          <div class="card-header">
            <h3><i class="fas fa-tasks"></i> Minhas Tarefas (Google)</h3>
          </div>
          <p>Você tem <span id="tarefas-count">?</span> tarefas pendentes.</p>
          <ul id="tarefas-list">
            <li>Faça login para ver suas tarefas.</li>
          </ul>
        </div>
        <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-calendar-alt"></i> Próximas Reuniões (Google)</h3>
            </div>
            <ul id="reunioes-list">
              <li>Faça login para ver suas reuniões.</li>
            </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="footer-buttons">
    <button onclick="window.location.href='home.html'"><i class="fas fa-home"></i> Home</button>
    <button onclick="window.open('http://10.10.10.5/tel/', '_blank')"><i class="fas fa-phone"></i> Lista Telefônica</button>
    <button onclick="window.open('suporteTI.html', '_blank')"><i class="fas fa-headset"></i> Suporte TI</button>
    <button onclick="window.open('http://10.10.10.105/pcp2110/web/login#/pcp_apontamentosdeproducoes?usuario=8498ff13-9f7b-42e1-bff0-9589ae20af14&modofiltro=OR')"><i class="fas fa-user-tie"></i> PCP NASAJON</button>
    <button onclick="window.open('http://10.10.10.5/pw', '_blank')"><i class="fas fa-key"></i> Minha PW</button>
    <button onclick="window.open('contato.html', '_blank')"><i class="fas fa-envelope"></i> Fale Conosco</button>
    <button onclick="window.open('recursos_humanos.html', '_blank')"><i class="fas fa-user-tie"></i> Recursos Humanos</button>
    <button onclick="window.open('comunicacao.html', '_blank')"><i class="fas fa-bullhorn"></i> Comunicação</button>
  </div>

  <div id="login-modal" class="modal hidden">
    <div class="modal-content login-modal-content">
      <span class="close" onclick="fecharModalLogin()">&times;</span>
      <h2><i class="fas fa-user-circle"></i> Login Corporativo</h2>
      <div class="login-form">
        <div class="google-login-btn" onclick="fazerLoginGoogle()"><img src="https://developers.google.com/identity/images/g-logo.png" alt="Google Logo"><span>Entrar com Google</span></div>
      </div>
    </div>
  </div>

  <script src="home.js"></script>
  <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
  


  
</body>
</html>

  <script>
    // Função para carregar comunicados de TI e SMAS
    function carregarComunicados() {
      const comunicadosContainer = document.getElementById('comunicados-gerais');
      
      // Obter comunicados do localStorage
      const comunicadosSalvos = localStorage.getItem('comunicacoes');
      let comunicados = [];
      
      if (comunicadosSalvos) {
        try {
          comunicados = JSON.parse(comunicadosSalvos);
        } catch (e) {
          console.error('Erro ao parsear comunicados:', e);
        }
      }
      
      // Filtrar apenas comunicados de TI e SMAS
      const comunicadosFiltrados = comunicados.filter(com => 
        com.departamento === 'ti' || com.departamento === 'smas'
      );
      
      // Ordenar por data (mais recentes primeiro)
      comunicadosFiltrados.sort((a, b) => {
        const timestampA = a.timestamp || new Date(a.data).getTime() || 0;
        const timestampB = b.timestamp || new Date(b.data).getTime() || 0;
        return timestampB - timestampA;
      });
      
      // Limpar o container
      comunicadosContainer.innerHTML = '';
      
      // Verificar se há comunicados
      if (comunicadosFiltrados.length === 0) {
        comunicadosContainer.innerHTML = `
          <div class="sem-comunicados">
            <p>Não há comunicados de TI ou SMAS no momento.</p>
            <a href="comunicacao.html" target="_blank">Acesse o portal de comunicação</a>
          </div>
        `;
        return;
      }
      
      // Exibir os comunicados (limitar a 6 mais recentes)
      const comunicadosExibir = comunicadosFiltrados.slice(0, 6);
      
      comunicadosExibir.forEach(comunicado => {
        const comunicadoCard = document.createElement('div');
        comunicadoCard.className = `comunicado-card ${comunicado.prioridade || 'normal'}`;
        
        // Formatar a data
        let dataFormatada = new Date().toLocaleDateString('pt-BR');
        if (comunicado.timestamp) {
          dataFormatada = new Date(comunicado.timestamp).toLocaleString('pt-BR', {
            day: '2-digit', month: '2-digit', year: 'numeric',
            hour: '2-digit', minute: '2-digit'
          });
        } else if (comunicado.data) {
          dataFormatada = comunicado.data;
        }
        
        // Definir cor e rótulo do departamento
        const deptColor = comunicado.departamento === 'ti' ? '#4caf50' : '#2196f3';
        const deptLabel = comunicado.departamento === 'ti' ? 'TI' : 'SMAS';
        
        // Badge de prioridade
        let priorityBadge = '';
        if (comunicado.prioridade === 'urgente') {
          priorityBadge = '<span class="priority-badge urgent">URGENTE</span>';
        } else if (comunicado.prioridade === 'importante') {
          priorityBadge = '<span class="priority-badge important">IMPORTANTE</span>';
        }
        
        // HTML da imagem, se existir
        let imagemHTML = '';
        if (comunicado.imagem) {
          imagemHTML = `<img src="${comunicado.imagem}" alt="Imagem do comunicado" class="comunicado-image">`;
        }
        
        comunicadoCard.innerHTML = `
          <div class="comunicado-header">
            <h3>${comunicado.titulo || 'Comunicado sem título'}</h3>
            <div class="comunicado-badges">
              <span class="dept-badge" style="background: ${deptColor};">${deptLabel}</span>
              ${priorityBadge}
            </div>
          </div>
          ${imagemHTML}
          <div class="comunicado-content">
            <p>${comunicado.conteudo || 'Sem conteúdo'}</p>
          </div>
          <div class="comunicado-footer">
            <span class="comunicado-author">Por: ${comunicado.autor || 'Autor desconhecido'}</span>
            <span class="comunicado-date">${dataFormatada}</span>
          </div>
        `;
        
        comunicadosContainer.appendChild(comunicadoCard);
      });
    }

    // Chamar a função quando a página carregar
    document.addEventListener('DOMContentLoaded', function() {
      carregarComunicados();
      
      // Atualizar a cada 30 segundos para pegar novos comunicados
      setInterval(carregarComunicados, 30000);
      
      // Também atualizar quando a página ganhar foco
      window.addEventListener('focus', carregarComunicados);
      
      // Escutar eventos de storage para atualizar em tempo real
      window.addEventListener('storage', function(e) {
        if (e.key === 'comunicacoes') {
          carregarComunicados();
        }
      });
    });

    // Outras funções existentes (mantidas iguais)
    function abrirModalLogin() {
      document.getElementById('login-modal').classList.remove('hidden');
    }

    function fecharModalLogin() {
      document.getElementById('login-modal').classList.add('hidden');
    }

    function validarEmail() {
      const emailInput = document.getElementById('email-input');
      const email = emailInput.value.trim();
      
      if (!email) {
        alert('Por favor, informe seu e-mail corporativo');
        return;
      }
      
      if (!email.endsWith('@pipeway.com.br')) {
        alert('Somente e-mails do domínio @pipeway.com.br são permitidos');
        return;
      }
      
      alert('E-mail de verificação enviado! Por favor, verifique sua caixa de entrada.');
    }

    function editarTarefas() {
      // Implementação existente
    }

    function fecharModal() {
      // Implementação existente
    }

    function salvarEdicao() {
      // Implementação existente
    }

    // Inicialização do contador de visitantes
    document.addEventListener('DOMContentLoaded', function() {
      let count = localStorage.getItem('visitorCount');
      if (count === null) {
        count = 1245;
      } else {
        count = parseInt(count) + 1;
      }
      localStorage.setItem('visitorCount', count);
      document.getElementById('visitor-count').textContent = count;
    });
  </script>
</body>
</html>